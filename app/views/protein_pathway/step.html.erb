<!-- Progress Bar -->
<div class="modern-section-sm" style="background: var(--modern-gray-50);">
  <div class="modern-container">
    <div class="progress-container">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h6 class="mb-0">Step <%= @current_step %> of 6</h6>
        <span class="modern-caption"><%= (@current_step * 100 / 6).round %>% Complete</span>
      </div>
      <div class="progress" style="height: 8px;">
        <div class="progress-bar bg-success" role="progressbar" style="width: <%= @current_step * 100 / 6 %>%"></div>
      </div>
    </div>
  </div>
</div>

<!-- Step Content -->
<section class="modern-section">
  <div class="modern-container">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        <!-- Step Header -->
        <div class="text-center mb-5">
          <div class="step-badge mb-3">
            <span class="badge bg-primary" style="font-size: 1rem; padding: 0.5rem 1rem;">
              Step <%= @service_package.step_number %>
            </span>
          </div>
          <h1 class="modern-h1"><%= @service_package.name %></h1>
          <p class="modern-body-lg text-muted mt-3">
            <%= @service_package.description %>
          </p>
        </div>

        <!-- Choice Cards -->
        <div class="row g-4 mb-4">
          <!-- DIY Option -->
          <div class="col-md-6">
            <div class="choice-card h-100">
              <div class="choice-card-header">
                <i class="bi bi-person-workspace"></i>
                <h3>Do It Yourself</h3>
              </div>
              <div class="choice-card-body">
                <div class="mb-3">
                  <%= simple_format(@service_package.diy_option) %>
                </div>

                <% if @service_package.diy_challenges.present? %>
                  <div class="alert alert-warning">
                    <strong><i class="bi bi-exclamation-triangle"></i> Challenges:</strong>
                    <%= simple_format(@service_package.diy_challenges) %>
                  </div>
                <% end %>

                <div class="text-center mt-4">
                  <%= link_to protein_pathway_select_path(step_number: @service_package.step_number, selection_type: "diy"),
                      data: { turbo_method: :post },
                      class: "modern-btn modern-btn-secondary w-100" do %>
                    <i class="bi bi-check-circle"></i> Choose DIY
                  <% end %>
                </div>
              </div>
            </div>
          </div>

          <!-- Service Option -->
          <div class="col-md-6">
            <div class="choice-card choice-card-featured h-100">
              <div class="choice-card-ribbon">Recommended</div>
              <div class="choice-card-header">
                <i class="bi bi-gear-wide-connected"></i>
                <h3>Do It With Us</h3>
              </div>
              <div class="choice-card-body">
                <div class="mb-3">
                  <%= simple_format(@service_package.service_option) %>
                </div>

                <% if @service_package.service_benefits.present? %>
                  <div class="alert alert-success">
                    <strong><i class="bi bi-stars"></i> Benefits:</strong>
                    <%= simple_format(@service_package.service_benefits) %>
                  </div>
                <% end %>

                <% if @service_package.whats_included.present? %>
                  <div class="mb-3">
                    <strong>What's Included:</strong>
                    <%= simple_format(@service_package.whats_included) %>
                  </div>
                <% end %>

                <div class="pricing-info mb-3">
                  <div class="d-flex justify-content-between align-items-center">
                    <span class="fw-bold">Price:</span>
                    <span class="h4 mb-0 text-success"><%= number_to_currency(@service_package.estimated_price) %></span>
                  </div>
                  <div class="d-flex justify-content-between align-items-center mt-2">
                    <span class="fw-bold">Turnaround:</span>
                    <span class="text-muted"><%= @service_package.estimated_turnaround %></span>
                  </div>
                </div>

                <div class="text-center mt-4">
                  <%= link_to protein_pathway_select_path(step_number: @service_package.step_number, selection_type: "service"),
                      data: { turbo_method: :post },
                      class: "modern-btn modern-btn-primary w-100" do %>
                    <i class="bi bi-check-circle"></i> Choose Service
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Navigation -->
        <div class="d-flex justify-content-between mt-5">
          <% if @current_step > 1 %>
            <%= link_to protein_pathway_step_path(step: @current_step - 1), class: "modern-btn modern-btn-secondary" do %>
              <i class="bi bi-arrow-left"></i> Previous Step
            <% end %>
          <% else %>
            <%= link_to protein_pathway_path, class: "modern-btn modern-btn-secondary" do %>
              <i class="bi bi-arrow-left"></i> Back to Overview
            <% end %>
          <% end %>

          <% if @previous_selections.where(step_number: @current_step).exists? %>
            <% if @current_step < 6 %>
              <%= link_to protein_pathway_step_path(step: @current_step + 1), class: "modern-btn modern-btn-accent" do %>
                Skip to Next <i class="bi bi-arrow-right"></i>
              <% end %>
            <% else %>
              <%= link_to protein_pathway_review_path, class: "modern-btn modern-btn-accent" do %>
                Review Selections <i class="bi bi-arrow-right"></i>
              <% end %>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
.choice-card {
  border: 2px solid var(--modern-gray-200);
  border-radius: 12px;
  padding: 1.5rem;
  transition: all 0.3s ease;
  position: relative;
}

.choice-card:hover {
  border-color: var(--modern-accent);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  transform: translateY(-2px);
}

.choice-card-featured {
  border-color: var(--modern-accent);
  background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
}

.choice-card-ribbon {
  position: absolute;
  top: -10px;
  right: 20px;
  background: var(--modern-accent);
  color: white;
  padding: 0.25rem 1rem;
  border-radius: 4px;
  font-size: 0.875rem;
  font-weight: bold;
}

.choice-card-header {
  text-align: center;
  margin-bottom: 1.5rem;
}

.choice-card-header i {
  font-size: 3rem;
  color: var(--modern-accent);
  margin-bottom: 1rem;
}

.choice-card-header h3 {
  font-size: 1.5rem;
  font-weight: bold;
  margin: 0;
}

.pricing-info {
  background: var(--modern-gray-50);
  padding: 1rem;
  border-radius: 8px;
}
</style>

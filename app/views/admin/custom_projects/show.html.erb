<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1><%= @custom_project.project_name %></h1>
        <div>
          <%= link_to "â† Back to Projects", admin_custom_projects_path, class: "btn btn-outline-secondary me-2" %>
          <%= link_to "Edit Project", edit_admin_custom_project_path(@custom_project), class: "btn btn-primary" %>
        </div>
      </div>

      <div class="row">
        <!-- Project Details -->
        <div class="col-md-8">
          <div class="card mb-4">
            <div class="card-header">
              <h5 class="mb-0">Project Details</h5>
            </div>
            <div class="card-body">
              <div class="row mb-3">
                <div class="col-sm-3"><strong>Status:</strong></div>
                <div class="col-sm-9">
                  <% case @custom_project.status %>
                  <% when 'pending' %>
                    <span class="badge bg-warning text-dark fs-6"><%= @custom_project.display_status %></span>
                  <% when 'in_progress' %>
                    <span class="badge bg-primary fs-6"><%= @custom_project.display_status %></span>
                  <% when 'completed' %>
                    <span class="badge bg-success fs-6"><%= @custom_project.display_status %></span>
                  <% when 'cancelled' %>
                    <span class="badge bg-danger fs-6"><%= @custom_project.display_status %></span>
                  <% else %>
                    <span class="badge bg-secondary fs-6"><%= @custom_project.display_status %></span>
                  <% end %>
                </div>
              </div>

              <% if @custom_project.project_type.present? %>
                <div class="row mb-3">
                  <div class="col-sm-3"><strong>Project Type:</strong></div>
                  <div class="col-sm-9">
                    <span class="badge bg-info"><%= @custom_project.project_type.humanize %></span>
                  </div>
                </div>
              <% end %>

              <% if @custom_project.description.present? %>
                <div class="row mb-3">
                  <div class="col-sm-3"><strong>Description:</strong></div>
                  <div class="col-sm-9"><%= simple_format(@custom_project.description) %></div>
                </div>
              <% end %>

              <div class="row mb-3">
                <div class="col-sm-3"><strong>Services:</strong></div>
                <div class="col-sm-9">
                  <% if @custom_project.total_services.any? %>
                    <ul class="list-unstyled mb-0">
                      <% @custom_project.total_services.each do |service| %>
                        <li><i class="bi bi-check-circle text-success"></i> <%= service %></li>
                      <% end %>
                    </ul>
                  <% else %>
                    <span class="text-muted">No specific services selected</span>
                  <% end %>
                </div>
              </div>

              <% if @custom_project.notes.present? %>
                <div class="row mb-3">
                  <div class="col-sm-3"><strong>Customer Notes:</strong></div>
                  <div class="col-sm-9"><%= simple_format(@custom_project.notes) %></div>
                </div>
              <% end %>
            </div>
          </div>

          <!-- Status Management -->
          <div class="card mb-4">
            <div class="card-header">
              <h5 class="mb-0">Status Management</h5>
            </div>
            <div class="card-body">
              <p class="text-muted mb-3">Update project status to notify the customer of progress:</p>
              <div class="btn-group" role="group">
                <%= button_to "Mark as In Progress", admin_custom_project_update_status_path(@custom_project), params: { status: 'in_progress' }, method: :patch, class: "btn #{'btn-primary' if @custom_project.status == 'in_progress'} #{'btn-outline-primary' if @custom_project.status != 'in_progress'}", form: { style: "display: inline;" }, data: { confirm: @custom_project.status == 'in_progress' ? nil : 'Mark this project as in progress?' } %>
                
                <%= button_to "Mark as Completed", admin_custom_project_update_status_path(@custom_project), params: { status: 'completed' }, method: :patch, class: "btn #{'btn-success' if @custom_project.status == 'completed'} #{'btn-outline-success' if @custom_project.status != 'completed'}", form: { style: "display: inline;" }, data: { confirm: @custom_project.status == 'completed' ? nil : 'Mark this project as completed?' } %>
                
                <%= button_to "Cancel Project", admin_custom_project_update_status_path(@custom_project), params: { status: 'cancelled' }, method: :patch, class: "btn #{'btn-danger' if @custom_project.status == 'cancelled'} #{'btn-outline-danger' if @custom_project.status != 'cancelled'}", form: { style: "display: inline;" }, data: { confirm: 'Are you sure you want to cancel this project?' } %>
              </div>
            </div>
          </div>
        </div>

        <!-- Customer & Timeline Info -->
        <div class="col-md-4">
          <div class="card mb-4">
            <div class="card-header">
              <h5 class="mb-0">Customer Information</h5>
            </div>
            <div class="card-body">
              <p><strong>Name:</strong><br><%= @custom_project.user.full_name.presence || "Not provided" %></p>
              <p><strong>Email:</strong><br><%= @custom_project.user.email_address %></p>
              <% if @custom_project.user.twist_username.present? %>
                <p><strong>Twist Username:</strong><br><%= @custom_project.user.twist_username %></p>
              <% end %>
              <p><strong>Customer Since:</strong><br><%= @custom_project.user.created_at.strftime("%B %Y") %></p>
              
              <hr>
              
              <%= link_to "View Customer Account", account_path, class: "btn btn-outline-info btn-sm" %>
            </div>
          </div>

          <div class="card mb-4">
            <div class="card-header">
              <h5 class="mb-0">Project Timeline</h5>
            </div>
            <div class="card-body">
              <p><strong>Submitted:</strong><br><%= @custom_project.created_at.strftime("%B %d, %Y at %I:%M %p") %></p>
              <p><strong>Last Updated:</strong><br><%= @custom_project.updated_at.strftime("%B %d, %Y at %I:%M %p") %></p>
              
              <% if @custom_project.estimated_cost.present? %>
                <hr>
                <p><strong>Estimated Cost:</strong><br><span class="h5 text-success">$<%= number_with_precision(@custom_project.estimated_cost, precision: 2) %></span></p>
              <% end %>
              
              <% if @custom_project.estimated_completion_date.present? %>
                <p><strong>Expected Completion:</strong><br><%= @custom_project.estimated_completion_date.strftime("%B %d, %Y") %></p>
              <% end %>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">Quick Actions</h5>
            </div>
            <div class="card-body">
              <div class="d-grid gap-2">
                <%= link_to "Edit Project Details", edit_admin_custom_project_path(@custom_project), class: "btn btn-outline-primary" %>
                <a href="mailto:<%= @custom_project.user.email_address %>?subject=RE: <%= @custom_project.project_name %>" class="btn btn-outline-secondary">Email Customer</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
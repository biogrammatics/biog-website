<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-900">Custom Projects Management</h1>
    <div class="flex gap-2">
      <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800"><%= @pending_projects.count %> Pending</span>
      <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800"><%= @in_progress_projects.count %> In Progress</span>
      <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800"><%= @completed_projects.count %> Completed</span>
    </div>
  </div>

  <!-- Tabs for different project statuses -->
  <div class="border-b border-gray-200 mb-6">
    <nav class="-mb-px flex space-x-8" aria-label="Tabs">
      <button class="tab-button border-blue-500 text-blue-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="pending">
        Pending Review <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800"><%= @pending_projects.count %></span>
      </button>
      <button class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="in-progress">
        In Progress <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"><%= @in_progress_projects.count %></span>
      </button>
      <button class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="completed">
        Completed <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"><%= @completed_projects.count %></span>
      </button>
      <button class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="all">
        All Projects <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800"><%= @custom_projects.count %></span>
      </button>
    </nav>
  </div>

  <!-- Tab content -->
  <div class="tab-content">
    <!-- Pending Projects -->
    <div class="tab-pane block" id="pending">
      <div class="bg-white rounded-lg border border-gray-200 shadow-sm">
        <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
          <h3 class="text-lg font-semibold text-gray-900">Projects Requiring Review</h3>
        </div>
        <div>
          <% if @pending_projects.any? %>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Project</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Services</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Submitted</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <% @pending_projects.each do |project| %>
                    <tr class="hover:bg-gray-50">
                      <td class="px-6 py-4 whitespace-nowrap">
                        <%= link_to project.project_name, admin_custom_project_path(project), class: "font-semibold text-blue-600 hover:text-blue-900" %>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <%= project.user.full_name.presence || project.user.email_address %>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <% if project.project_type.present? %>
                          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-cyan-100 text-cyan-800"><%= project.project_type.humanize %></span>
                        <% else %>
                          <span class="text-gray-500 text-sm">Not specified</span>
                        <% end %>
                      </td>
                      <td class="px-6 py-4 text-sm text-gray-900">
                        <% if project.total_services.any? %>
                          <% project.total_services.each do |service| %>
                            <div class="text-green-600 text-xs">
                              <svg class="inline w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                              </svg>
                              <%= service %>
                            </div>
                          <% end %>
                        <% else %>
                          <span class="text-gray-500 text-sm">None specified</span>
                        <% end %>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <%= time_ago_in_words(project.created_at) %> ago
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex space-x-2">
                          <%= link_to "Review", admin_custom_project_path(project), class: "text-blue-600 hover:text-blue-900" %>
                          <%= button_to "Approve", admin_custom_project_update_status_path(project), params: { status: 'in_progress' }, method: :patch, class: "text-green-600 hover:text-green-900" %>
                        </div>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <div class="text-center py-12">
              <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <h3 class="mt-2 text-lg font-medium text-gray-900">No Pending Projects</h3>
              <p class="mt-1 text-sm text-gray-500">All projects have been reviewed.</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- In Progress Projects -->
    <div class="tab-pane hidden" id="in-progress">
      <div class="bg-white rounded-lg border border-gray-200 shadow-sm">
        <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
          <h3 class="text-lg font-semibold text-gray-900">Active Projects</h3>
        </div>
        <div>
          <% if @in_progress_projects.any? %>
            <%= render 'projects_table', projects: @in_progress_projects %>
          <% else %>
            <div class="text-center py-12">
              <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <h3 class="mt-2 text-lg font-medium text-gray-900">No Active Projects</h3>
              <p class="mt-1 text-sm text-gray-500">No projects are currently in progress.</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Completed Projects -->
    <div class="tab-pane hidden" id="completed">
      <div class="bg-white rounded-lg border border-gray-200 shadow-sm">
        <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
          <h3 class="text-lg font-semibold text-gray-900">Completed Projects</h3>
        </div>
        <div>
          <% if @completed_projects.any? %>
            <%= render 'projects_table', projects: @completed_projects %>
          <% else %>
            <div class="text-center py-12">
              <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
              </svg>
              <h3 class="mt-2 text-lg font-medium text-gray-900">No Completed Projects</h3>
              <p class="mt-1 text-sm text-gray-500">No projects have been completed yet.</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- All Projects -->
    <div class="tab-pane hidden" id="all">
      <div class="bg-white rounded-lg border border-gray-200 shadow-sm">
        <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
          <h3 class="text-lg font-semibold text-gray-900">All Projects</h3>
        </div>
        <div>
          <%= render 'projects_table', projects: @custom_projects %>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabPanes = document.querySelectorAll('.tab-pane');

    tabButtons.forEach(button => {
      button.addEventListener('click', function() {
        const targetTab = this.dataset.tab;

        // Update button styles
        tabButtons.forEach(btn => {
          btn.classList.remove('border-blue-500', 'text-blue-600');
          btn.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
        });
        this.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
        this.classList.add('border-blue-500', 'text-blue-600');

        // Update tab panes
        tabPanes.forEach(pane => {
          if (pane.id === targetTab) {
            pane.classList.remove('hidden');
            pane.classList.add('block');
          } else {
            pane.classList.remove('block');
            pane.classList.add('hidden');
          }
        });
      });
    });
  });
</script>
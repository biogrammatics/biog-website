<% if show_cookie_banner? %>
  <div id="cookieBanner" class="cookie-banner position-fixed bottom-0 start-0 end-0 bg-white border-top shadow-lg p-3" style="z-index: 1050;">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-8">
          <h5 class="mb-2">Cookie Settings</h5>
          <p class="mb-2">
            We use cookies to enhance your browsing experience and analyze site traffic. 
            By clicking "Accept All", you consent to our use of cookies. 
            <%= link_to "Learn more", cookies_policy_path, target: "_blank", class: "text-decoration-underline" %>
          </p>
        </div>
        <div class="col-lg-4 text-lg-end">
          <button type="button" class="btn btn-sm btn-outline-secondary me-2" onclick="manageCookies()">
            Manage Cookies
          </button>
          <button type="button" class="btn btn-sm btn-outline-secondary me-2" onclick="rejectAll()">
            Reject All
          </button>
          <button type="button" class="btn btn-sm btn-primary" onclick="acceptAll()">
            Accept All
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Cookie Preferences Modal -->
  <div class="modal fade" id="cookieModal" tabindex="-1" aria-labelledby="cookieModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="cookieModalLabel">Cookie Preferences</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="text-muted mb-4">
            We use different types of cookies to optimize your experience. Click on the categories below to learn more 
            and change your preferences. Note that blocking some types of cookies may impact your experience.
          </p>

          <div class="mb-3">
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="essentialCookies" checked disabled>
              <label class="form-check-label" for="essentialCookies">
                <strong>Essential Cookies</strong>
                <span class="badge bg-secondary ms-2">Always Active</span>
              </label>
              <p class="text-muted small mt-1">
                These cookies are necessary for the website to function and cannot be switched off. 
                They are usually set in response to actions you take, like signing in or filling in forms.
              </p>
            </div>
          </div>

          <div class="mb-3">
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="analyticsCookies">
              <label class="form-check-label" for="analyticsCookies">
                <strong>Analytics Cookies</strong>
              </label>
              <p class="text-muted small mt-1">
                These cookies help us understand how visitors interact with our website by collecting 
                and reporting information anonymously. This helps us improve our service.
              </p>
            </div>
          </div>

          <div class="mb-3">
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="marketingCookies">
              <label class="form-check-label" for="marketingCookies">
                <strong>Marketing Cookies</strong>
              </label>
              <p class="text-muted small mt-1">
                These cookies are used to track visitors across websites to display ads that are 
                relevant and engaging for individual users.
              </p>
            </div>
          </div>

          <div class="alert alert-info small">
            <i class="bi bi-info-circle me-2"></i>
            You can change your preferences at any time by clicking the "Cookie Settings" link in the footer.
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="savePreferences()">Save Preferences</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    function acceptAll() {
      updateConsent(true, true, true);
    }

    function rejectAll() {
      updateConsent(true, false, false);
    }

    function manageCookies() {
      const modal = new bootstrap.Modal(document.getElementById('cookieModal'));
      modal.show();
    }

    function savePreferences() {
      const analytics = document.getElementById('analyticsCookies').checked;
      const marketing = document.getElementById('marketingCookies').checked;
      updateConsent(true, analytics, marketing);
      bootstrap.Modal.getInstance(document.getElementById('cookieModal')).hide();
    }

    function updateConsent(essential, analytics, marketing) {
      fetch('/cookies/consent', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
        },
        body: JSON.stringify({
          essential: essential,
          analytics: analytics,
          marketing: marketing
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.status === 'success') {
          document.getElementById('cookieBanner').style.display = 'none';
          // Reload page to apply new cookie settings
          window.location.reload();
        }
      });
    }
  </script>

  <style>
    .cookie-banner {
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    }
    @media (max-width: 991px) {
      .cookie-banner .col-lg-4 {
        margin-top: 1rem;
      }
    }
  </style>
<% end %>
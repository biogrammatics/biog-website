<div class="container-custom py-8">
  <div class="max-w-5xl mx-auto">
    <% if @checkout %>
      <div class="bg-blue-50 border border-blue-200 rounded-xl p-6 mb-6">
        <h5 class="text-lg font-semibold text-blue-900 mb-2">Account Required for Checkout</h5>
        <p class="text-blue-800">To complete your purchase, please sign in to your existing account or create a new one. Your cart items will be preserved.</p>
      </div>
    <% end %>

    <% if flash[:alert] %>
      <div class="bg-red-50 border border-red-200 rounded-xl p-6 mb-6">
        <p class="text-red-800"><%= flash[:alert] %></p>
      </div>
    <% end %>
    <% if flash[:notice] %>
      <div class="bg-green-50 border border-green-200 rounded-xl p-6 mb-6">
        <p class="text-green-800"><%= flash[:notice] %></p>
      </div>
    <% end %>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Sign In Form -->
      <div>
        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
          <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
            <h4 class="text-xl font-semibold text-gray-900">Sign In</h4>
          </div>
          <div class="p-6">
            <%= form_with url: session_path, local: true do |form| %>
              <% if @checkout %>
                <%= form.hidden_field :checkout, value: true %>
              <% end %>

              <div class="mb-4">
                <%= form.label :email_address, class: "block text-sm font-medium text-gray-700 mb-2" %>
                <%= form.email_field :email_address,
                    required: true,
                    autofocus: !@checkout,
                    autocomplete: "username",
                    class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-bio-green focus:border-bio-green transition-colors",
                    value: params[:email_address] %>
              </div>

              <div class="mb-6">
                <%= form.label :password, class: "block text-sm font-medium text-gray-700 mb-2" %>
                <div class="flex">
                  <%= form.password_field :password,
                      required: true,
                      autocomplete: "current-password",
                      class: "w-full px-4 py-2 border border-gray-300 rounded-l-lg focus:ring-2 focus:ring-bio-green focus:border-bio-green transition-colors",
                      maxlength: 72,
                      id: "signin-password" %>
                  <button class="inline-flex items-center justify-center px-4 border-2 border-l-0 border-gray-300 text-gray-700 rounded-r-lg hover:bg-gray-50 transition-colors" type="button" id="toggle-signin-password">
                    <i class="bi bi-eye" id="signin-password-icon"></i>
                  </button>
                </div>
              </div>

              <div>
                <%= form.submit "Sign In", class: "w-full inline-flex items-center justify-center px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors" %>
              </div>
            <% end %>

            <div class="text-center mt-4">
              <%= link_to "Forgot password?", new_password_path, class: "text-blue-600 hover:text-blue-700 font-medium" %>
            </div>
          </div>
        </div>
      </div>

      <!-- Create Account Form -->
      <div>
        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
          <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
            <h4 class="text-xl font-semibold text-gray-900">Create Account</h4>
          </div>
          <div class="p-6">
            <%= form_with model: @user, url: session_path, local: true do |form| %>
              <% if @checkout %>
                <%= form.hidden_field :checkout, value: true %>
              <% end %>

              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                <div>
                  <%= form.label :first_name, class: "block text-sm font-medium text-gray-700 mb-2" %>
                  <%= form.text_field :first_name, class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-bio-green focus:border-bio-green transition-colors" %>
                </div>
                <div>
                  <%= form.label :last_name, class: "block text-sm font-medium text-gray-700 mb-2" %>
                  <%= form.text_field :last_name, class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-bio-green focus:border-bio-green transition-colors" %>
                </div>
              </div>

              <div class="mb-4">
                <%= form.label :email_address, class: "block text-sm font-medium text-gray-700 mb-2" %>
                <%= form.email_field :email_address,
                    required: true,
                    class: "w-full px-4 py-2 border #{ @user.errors[:email_address].any? ? 'border-red-500' : 'border-gray-300' } rounded-lg focus:ring-2 focus:ring-bio-green focus:border-bio-green transition-colors" %>
                <% if @user.errors[:email_address].any? %>
                  <p class="mt-1 text-sm text-red-600">
                    <%= @user.errors[:email_address].first %>
                  </p>
                <% end %>
              </div>

              <div class="mb-4">
                <%= form.label :password, class: "block text-sm font-medium text-gray-700 mb-2" %>
                <div class="flex">
                  <%= form.password_field :password,
                      required: true,
                      class: "w-full px-4 py-2 border #{ @user.errors[:password].any? ? 'border-red-500' : 'border-gray-300' } rounded-l-lg focus:ring-2 focus:ring-bio-green focus:border-bio-green transition-colors",
                      autocomplete: "new-password",
                      id: "signup-password" %>
                  <button class="inline-flex items-center justify-center px-4 border-2 border-l-0 #{ @user.errors[:password].any? ? 'border-red-500' : 'border-gray-300' } text-gray-700 rounded-r-lg hover:bg-gray-50 transition-colors" type="button" id="toggle-signup-password">
                    <i class="bi bi-eye" id="signup-password-icon"></i>
                  </button>
                </div>
                <% if @user.errors[:password].any? %>
                  <p class="mt-1 text-sm text-red-600">
                    <%= @user.errors[:password].first %>
                  </p>
                <% end %>
              </div>

              <div class="mb-6">
                <%= form.label :password_confirmation, "Confirm Password", class: "block text-sm font-medium text-gray-700 mb-2" %>
                <div class="flex">
                  <%= form.password_field :password_confirmation,
                      required: true,
                      class: "w-full px-4 py-2 border border-gray-300 rounded-l-lg focus:ring-2 focus:ring-bio-green focus:border-bio-green transition-colors",
                      autocomplete: "new-password",
                      id: "signup-password-confirm" %>
                  <button class="inline-flex items-center justify-center px-4 border-2 border-l-0 border-gray-300 text-gray-700 rounded-r-lg hover:bg-gray-50 transition-colors" type="button" id="toggle-signup-password-confirm">
                    <i class="bi bi-eye" id="signup-password-confirm-icon"></i>
                  </button>
                </div>
              </div>

              <div>
                <%= form.submit "Create Account", class: "w-full inline-flex items-center justify-center px-6 py-3 bg-bio-green text-white font-medium rounded-lg hover:bg-bio-green-dark transition-colors" %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <% unless @checkout %>
      <div class="text-center mt-6">
        <%= link_to "â† Back to Home", root_path, class: "inline-flex items-center justify-center px-6 py-3 border-2 border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors" %>
      </div>
    <% end %>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Toggle sign-in password visibility
  const toggleSigninPassword = document.getElementById('toggle-signin-password');
  if (toggleSigninPassword) {
    toggleSigninPassword.addEventListener('click', function() {
      const passwordField = document.getElementById('signin-password');
      const icon = document.getElementById('signin-password-icon');
      
      if (passwordField.type === 'password') {
        passwordField.type = 'text';
        icon.classList.remove('bi-eye');
        icon.classList.add('bi-eye-slash');
      } else {
        passwordField.type = 'password';
        icon.classList.remove('bi-eye-slash');
        icon.classList.add('bi-eye');
      }
    });
  }
  
  // Toggle sign-up password visibility
  const toggleSignupPassword = document.getElementById('toggle-signup-password');
  if (toggleSignupPassword) {
    toggleSignupPassword.addEventListener('click', function() {
      const passwordField = document.getElementById('signup-password');
      const icon = document.getElementById('signup-password-icon');
      
      if (passwordField.type === 'password') {
        passwordField.type = 'text';
        icon.classList.remove('bi-eye');
        icon.classList.add('bi-eye-slash');
      } else {
        passwordField.type = 'password';
        icon.classList.remove('bi-eye-slash');
        icon.classList.add('bi-eye');
      }
    });
  }
  
  // Toggle sign-up password confirmation visibility
  const toggleSignupPasswordConfirm = document.getElementById('toggle-signup-password-confirm');
  if (toggleSignupPasswordConfirm) {
    toggleSignupPasswordConfirm.addEventListener('click', function() {
      const passwordField = document.getElementById('signup-password-confirm');
      const icon = document.getElementById('signup-password-confirm-icon');
      
      if (passwordField.type === 'password') {
        passwordField.type = 'text';
        icon.classList.remove('bi-eye');
        icon.classList.add('bi-eye-slash');
      } else {
        passwordField.type = 'password';
        icon.classList.remove('bi-eye-slash');
        icon.classList.add('bi-eye');
      }
    });
  }
});
</script>

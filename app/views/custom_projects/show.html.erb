<div class="container-custom py-8">
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <div class="lg:col-span-2">
      <h1 class="flex items-center text-3xl font-bold mb-4">
        <% if @custom_project.protein_expression_project? %>
          <i class="bi bi-dna mr-3 text-blue-600"></i>
        <% else %>
          <i class="bi bi-balloon mr-3 text-bio-green"></i>
        <% end %>
        <%= @custom_project.project_name %>
      </h1>

      <div class="mb-6">
        <% case @custom_project.status %>
        <% when 'pending' %>
          <span class="inline-flex items-center px-3 py-1 rounded-md bg-yellow-100 text-yellow-700 text-base font-medium"><%= @custom_project.display_status %></span>
        <% when 'in_progress' %>
          <span class="inline-flex items-center px-3 py-1 rounded-md bg-blue-100 text-blue-700 text-base font-medium"><%= @custom_project.display_status %></span>
        <% when 'awaiting_approval' %>
          <span class="inline-flex items-center px-3 py-1 rounded-md bg-cyan-100 text-cyan-700 text-base font-medium"><%= @custom_project.display_status %></span>
        <% when 'sequence_approved' %>
          <span class="inline-flex items-center px-3 py-1 rounded-md bg-green-100 text-green-700 text-base font-medium"><%= @custom_project.display_status %></span>
        <% when 'completed' %>
          <span class="inline-flex items-center px-3 py-1 rounded-md bg-green-100 text-green-700 text-base font-medium"><%= @custom_project.display_status %></span>
        <% when 'cancelled' %>
          <span class="inline-flex items-center px-3 py-1 rounded-md bg-red-100 text-red-700 text-base font-medium"><%= @custom_project.display_status %></span>
        <% else %>
          <span class="inline-flex items-center px-3 py-1 rounded-md bg-gray-100 text-gray-700 text-base font-medium"><%= @custom_project.display_status %></span>
        <% end %>

        <% if @custom_project.project_type.present? %>
          <span class="inline-flex items-center px-3 py-1 rounded-md bg-blue-100 text-blue-700 text-base font-medium ml-2"><%= @custom_project.project_type.humanize %></span>
        <% end %>
      </div>
      
      <% if @custom_project.protein_expression_project? %>
        <!-- Protein Expression Details -->
        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden mb-6">
          <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
            <h5 class="text-lg font-semibold">Protein Information</h5>
          </div>
          <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <h6 class="font-semibold mb-1">Protein Name:</h6>
                <p class="ml-4"><%= @custom_project.protein_name %></p>
              </div>
              <div>
                <h6 class="font-semibold mb-1">Sequence Length:</h6>
                <p class="ml-4"><%= @custom_project.sequence_length %> amino acids</p>
              </div>
            </div>

            <% if @custom_project.protein_description.present? %>
              <h6 class="font-semibold mb-2">Description:</h6>
              <p class="ml-4 mb-4"><%= simple_format(@custom_project.protein_description) %></p>
            <% end %>

            <h6 class="font-semibold mb-2">Amino Acid Sequence:</h6>
            <div class="bg-gray-50 rounded-xl border border-gray-200 p-4 mb-4">
              <code class="block text-sm leading-relaxed break-all">
                <%= @custom_project.clean_amino_acid_sequence %>
              </code>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
              <div>
                <small class="text-sm">
                  <strong>Starts with M:</strong>
                  <%= @custom_project.starts_with_methionine? ? '<span class="text-green-600">✓ Yes</span>'.html_safe : '<span class="text-red-600">✗ No</span>'.html_safe %>
                </small>
              </div>
              <div>
                <small class="text-sm">
                  <strong>Ends with *:</strong>
                  <%= @custom_project.ends_with_stop_codon? ? '<span class="text-green-600">✓ Yes</span>'.html_safe : '<span class="text-red-600">✗ No</span>'.html_safe %>
                </small>
              </div>
              <div>
                <small class="text-sm">
                  <strong>Est. Molecular Weight:</strong>
                  ~<%= number_with_delimiter(@custom_project.estimated_molecular_weight) %> Da
                </small>
              </div>
            </div>
          </div>
        </div>

        <!-- Vector Selection -->
        <% if @custom_project.selected_vector.present? %>
          <div class="bg-white rounded-xl border border-gray-200 overflow-hidden mb-6">
            <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
              <h5 class="text-lg font-semibold">Selected Expression Vector</h5>
            </div>
            <div class="p-6">
              <div class="flex justify-between items-start">
                <div class="flex-1">
                  <h6 class="font-semibold mb-1"><%= @custom_project.selected_vector.display_name %></h6>
                  <p class="text-gray-600 mb-3"><%= @custom_project.selected_vector.description %></p>

                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div>
                      <small class="text-sm">
                        <strong>Backbone:</strong> <%= @custom_project.selected_vector.backbone %><br>
                        <strong>Cloning Sites:</strong> <%= @custom_project.selected_vector.cloning_sites %>
                      </small>
                    </div>
                    <div>
                      <small class="text-sm">
                        <% if @custom_project.selected_vector.feature_list.any? %>
                          <strong>Features:</strong> <%= @custom_project.selected_vector.feature_list.join(', ') %>
                        <% end %>
                      </small>
                    </div>
                  </div>
                </div>
                <div class="text-right ml-4">
                  <h6 class="text-blue-600 font-semibold"><%= @custom_project.selected_vector.formatted_price %></h6>
                </div>
              </div>
            </div>
          </div>
        <% end %>

        <!-- DNA Sequence Section -->
        <% if @custom_project.dna_sequence.present? %>
          <div class="bg-white rounded-xl border border-gray-200 overflow-hidden mb-6">
            <div class="px-6 py-4 border-b border-gray-200 bg-gray-50 flex justify-between items-center">
              <h5 class="text-lg font-semibold">Generated DNA Sequence</h5>
              <% if @custom_project.status == 'awaiting_approval' %>
                <span class="inline-flex items-center px-2 py-1 rounded-md bg-yellow-100 text-yellow-700 text-xs font-medium">Awaiting Your Approval</span>
              <% elsif @custom_project.dna_sequence_approved? %>
                <span class="inline-flex items-center px-2 py-1 rounded-md bg-green-100 text-green-700 text-xs font-medium">Approved</span>
              <% end %>
            </div>
            <div class="p-6">
              <% if @custom_project.codon_optimization_notes.present? %>
                <div class="bg-blue-50 border border-blue-200 rounded-xl p-6 mb-4">
                  <strong>Codon Optimization Notes:</strong><br>
                  <%= @custom_project.codon_optimization_notes %>
                </div>
              <% end %>

              <h6 class="font-semibold mb-2">Codon-Optimized DNA Sequence:</h6>
              <div class="bg-gray-50 rounded-xl border border-gray-200 p-4 mb-4">
                <code class="block text-sm leading-snug break-all">
                  <%= simple_format(@custom_project.dna_sequence.scan(/.{1,60}/).join("\n"), {}, wrapper_tag: 'span') %>
                </code>
              </div>

              <div class="mt-4">
                <small class="text-gray-600">
                  <strong>DNA Length:</strong> <%= @custom_project.dna_sequence.length %> nucleotides
                </small>
              </div>

              <!-- Approval Buttons -->
              <% if @custom_project.status == 'awaiting_approval' %>
                <div class="mt-4">
                  <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-6">
                    <h6 class="font-semibold mb-2">Sequence Approval Required</h6>
                    <p class="mb-4">Please review the generated DNA sequence above. Do you approve this sequence for synthesis and cloning?</p>
                    <div class="flex gap-3">
                      <%= form_with url: approve_dna_sequence_custom_project_path(@custom_project), method: :patch, local: true,
                          class: "inline", data: { turbo_confirm: "Are you sure you want to approve this DNA sequence? Once approved, we'll begin synthesis and cloning." } do |form| %>
                        <%= form.submit "✓ Approve Sequence", class: "inline-flex items-center px-6 py-3 bg-bio-green text-white font-medium rounded-lg hover:bg-bio-green-dark transition-colors" %>
                      <% end %>
                      <%= form_with url: reject_dna_sequence_custom_project_path(@custom_project), method: :patch, local: true,
                          class: "inline", data: { turbo_confirm: "This will reject the current sequence and request a new one to be generated." } do |form| %>
                        <%= form.submit "✗ Request New Sequence", class: "inline-flex items-center px-6 py-3 border-2 border-red-600 text-red-600 font-medium rounded-lg hover:bg-red-50 transition-colors" %>
                      <% end %>
                    </div>
                  </div>
                </div>
              <% elsif @custom_project.dna_sequence_approved? %>
                <div class="mt-4">
                  <div class="bg-green-50 border border-green-200 rounded-xl p-6">
                    <h6 class="font-semibold mb-2">✓ Sequence Approved</h6>
                    <p class="mb-0">You have approved this DNA sequence. We are now proceeding with synthesis and cloning into your selected vector.</p>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>

      <% else %>
        <!-- Standard Custom Project Details -->
        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden mb-6">
          <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
            <h5 class="text-lg font-semibold">Project Details</h5>
          </div>
          <div class="p-6">
            <% if @custom_project.description.present? %>
              <h6 class="font-semibold mb-2">Description:</h6>
              <p class="ml-4 mb-4"><%= simple_format(@custom_project.description) %></p>
            <% end %>

            <h6 class="font-semibold mb-2">Services:</h6>
            <ul class="ml-8 list-disc">
              <% if @custom_project.strain_generation? %>
                <li>Custom Strain Generation</li>
              <% end %>
              <% if @custom_project.expression_testing? %>
                <li>Expression Testing & Optimization</li>
              <% end %>
              <% if !@custom_project.strain_generation? && !@custom_project.expression_testing? %>
                <li class="text-gray-600">No specific services selected</li>
              <% end %>
            </ul>
          </div>
        </div>
      <% end %>

      <!-- Additional Notes (shown for all project types) -->
      <% if @custom_project.notes.present? %>
        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden mb-6">
          <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
            <h5 class="text-lg font-semibold">Additional Notes</h5>
          </div>
          <div class="p-6">
            <%= simple_format(@custom_project.notes) %>
          </div>
        </div>
      <% end %>

      <% if @custom_project.estimated_cost.present? || @custom_project.estimated_completion_date.present? %>
        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden mb-6">
          <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
            <h5 class="text-lg font-semibold">Project Estimates</h5>
          </div>
          <div class="p-6">
            <% if @custom_project.estimated_cost.present? %>
              <p class="mb-2"><strong>Estimated Cost:</strong> $<%= number_with_precision(@custom_project.estimated_cost, precision: 2) %></p>
            <% end %>
            <% if @custom_project.estimated_completion_date.present? %>
              <p class="mb-0"><strong>Estimated Completion:</strong> <%= @custom_project.estimated_completion_date.strftime("%B %d, %Y") %></p>
            <% end %>
          </div>
        </div>
      <% end %>

      <div class="flex flex-col sm:flex-row gap-3">
        <%= link_to "Edit Project", edit_custom_project_path(@custom_project), class: "inline-flex items-center justify-center px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors" %>
        <%= link_to "Back to Projects", custom_projects_path, class: "inline-flex items-center justify-center px-6 py-3 border-2 border-gray-400 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors" %>
        <% if @custom_project.status == 'pending' || @custom_project.status == 'cancelled' %>
          <%= link_to "Delete Project", custom_project_path(@custom_project),
              data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this project?" },
              class: "inline-flex items-center justify-center px-6 py-3 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition-colors" %>
        <% end %>
      </div>
    </div>

    <div class="lg:col-span-1">
      <div class="bg-white rounded-xl border border-gray-200 overflow-hidden mb-6">
        <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
          <h5 class="text-lg font-semibold">Project Timeline</h5>
        </div>
        <div class="p-6">
          <p class="mb-3"><strong>Created:</strong><br><%= @custom_project.created_at.strftime("%B %d, %Y at %I:%M %p") %></p>
          <p class="mb-0"><strong>Last Updated:</strong><br><%= @custom_project.updated_at.strftime("%B %d, %Y at %I:%M %p") %></p>
        </div>
      </div>

      <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
          <h5 class="text-lg font-semibold">Need Help?</h5>
        </div>
        <div class="p-6">
          <p class="mb-4">Have questions about your project?</p>
          <a href="mailto:support@biogrammatics.com" class="inline-flex items-center px-4 py-2 border-2 border-blue-600 text-blue-600 font-medium rounded-lg hover:bg-blue-50 transition-colors text-sm">Contact Support</a>
        </div>
      </div>
    </div>
  </div>
</div>
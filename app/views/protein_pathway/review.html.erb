<!-- Header -->
<div class="bg-gray-50 py-8 border-b border-gray-200">
  <div class="container-custom">
    <div class="text-center">
      <h1 class="text-4xl font-bold text-charcoal mb-2">Review Your Path</h1>
      <p class="text-lg text-gray-600">
        Review your selections and get your customized quote
      </p>
    </div>
  </div>
</div>

<!-- Selections Review -->
<div class="container-custom py-8">
  <div class="max-w-4xl mx-auto">
    <% if @selections.empty? %>
      <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center">
        <i class="bi bi-exclamation-triangle text-yellow-600 text-4xl mb-3"></i>
        <p class="text-gray-700 mb-3">
          You haven't made any selections yet.
        </p>
        <%= link_to "Start from Step 1", protein_pathway_step_path(step: 1), class: "inline-flex items-center gap-2 px-4 py-2 bg-bio-green text-white font-medium rounded-lg hover:bg-bio-green-dark transition-colors" %>
      </div>
    <% else %>
      <!-- Selections Summary -->
      <div class="bg-white rounded-xl border border-gray-200 overflow-hidden mb-6">
        <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
          <h3 class="text-lg font-semibold text-charcoal flex items-center gap-2">
            <i class="bi bi-list-check text-bio-green"></i>
            Your Selections
          </h3>
        </div>
        <div class="p-6">
          <% @selections.each_with_index do |selection, index| %>
            <div class="<%= 'pb-6 mb-6 border-b border-gray-200' unless index == @selections.length - 1 %>">
              <div class="flex justify-between items-start gap-4">
                <div class="flex-grow">
                  <div class="flex items-center gap-3 mb-3">
                    <span class="inline-flex items-center px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-sm font-medium">
                      Step <%= selection.step_number %>
                    </span>
                    <h5 class="text-lg font-semibold text-charcoal"><%= selection.service_package.name %></h5>
                  </div>

                  <div class="ml-3 pl-3 border-l-2 <%= selection.diy? ? 'border-blue-300' : 'border-green-300' %>">
                    <% if selection.diy? %>
                      <div class="flex items-center gap-2 mb-2">
                        <span class="inline-flex items-center px-3 py-1 rounded-md bg-blue-100 text-blue-700 text-sm font-medium">
                          <i class="bi bi-person-workspace mr-1"></i> DIY
                        </span>
                      </div>
                      <p class="text-sm text-gray-600">You'll handle this step in your own lab</p>
                    <% else %>
                      <div class="flex items-center gap-2 mb-2">
                        <span class="inline-flex items-center px-3 py-1 rounded-md bg-green-100 text-green-700 text-sm font-medium">
                          <i class="bi bi-gear-wide-connected mr-1"></i> Service
                        </span>
                      </div>
                      <div class="text-sm text-gray-700">
                        <span class="font-medium">Price:</span> <%= number_to_currency(selection.service_package.estimated_price) %>
                        <span class="text-gray-400 mx-2">â€¢</span>
                        <span class="font-medium">Turnaround:</span> <%= selection.service_package.estimated_turnaround %>
                      </div>
                    <% end %>
                  </div>
                </div>

                <div>
                  <%= link_to protein_pathway_step_path(step: selection.step_number), class: "inline-flex items-center gap-2 px-3 py-2 border border-gray-300 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-50 transition-colors" do %>
                    <i class="bi bi-pencil"></i> Edit
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Service Summary -->
      <% if @service_selections.any? %>
        <div class="bg-white rounded-xl border-2 border-bio-green overflow-hidden mb-6">
          <div class="px-6 py-4 border-b border-bio-green bg-bio-green text-white">
            <h3 class="text-lg font-semibold flex items-center gap-2">
              <i class="bi bi-calculator"></i>
              Service Estimate
            </h3>
          </div>
          <div class="p-6">
            <div class="space-y-3 mb-4">
              <% @service_selections.each do |selection| %>
                <div class="flex justify-between items-center">
                  <span class="text-gray-700"><%= selection.service_package.name %></span>
                  <span class="font-medium text-gray-900"><%= number_to_currency(selection.service_package.estimated_price) %></span>
                </div>
              <% end %>
            </div>

            <div class="pt-4 border-t-2 border-gray-200">
              <div class="flex justify-between items-center mb-4">
                <span class="text-lg font-bold text-charcoal">Estimated Total</span>
                <span class="text-3xl font-bold text-bio-green"><%= number_to_currency(@total_estimate) %></span>
              </div>

              <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <div class="flex gap-2 items-start">
                  <i class="bi bi-info-circle text-blue-600 flex-shrink-0 mt-0.5"></i>
                  <p class="text-sm text-gray-700">
                    This is an estimate. Final pricing will be provided in your detailed quote based on your specific requirements.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% else %>
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
          <div class="flex gap-3 items-start">
            <i class="bi bi-info-circle text-blue-600 text-xl flex-shrink-0"></i>
            <p class="text-gray-700">
              You've chosen to DIY all steps. You can purchase reagents directly from our catalog.
            </p>
          </div>
        </div>
      <% end %>

      <!-- CTA Buttons -->
      <div class="flex flex-col sm:flex-row gap-3">
        <%= link_to protein_pathway_step_path(step: 1), class: "inline-flex items-center justify-center gap-2 px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors" do %>
          <i class="bi bi-arrow-left"></i> Back to Steps
        <% end %>

        <% if @service_selections.any? %>
          <%= link_to protein_pathway_quote_form_path, class: "flex-grow inline-flex items-center justify-center gap-2 px-6 py-3 bg-bio-green text-white font-semibold rounded-lg hover:bg-bio-green-dark transition-colors shadow-md hover:shadow-lg" do %>
            Request Detailed Quote <i class="bi bi-arrow-right"></i>
          <% end %>
        <% else %>
          <%= link_to vectors_path, class: "flex-grow inline-flex items-center justify-center gap-2 px-6 py-3 bg-bio-green text-white font-semibold rounded-lg hover:bg-bio-green-dark transition-colors shadow-md hover:shadow-lg" do %>
            Browse Reagents <i class="bi bi-arrow-right"></i>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

<!-- Hero Section -->
<div class="bg-gradient-to-br from-gray-50 to-white py-12 border-b border-gray-200">
  <div class="container-custom">
    <h1 class="text-4xl font-bold text-charcoal mb-3">Vector Collection</h1>
    <p class="text-lg text-gray-600 max-w-3xl">Browse our comprehensive collection of Pichia pastoris vectors for protein expression and genome engineering</p>
  </div>
</div>

<!-- Filters Section -->
<div class="bg-white border-b border-gray-200 sticky top-16 z-40 py-4">
  <div class="container-custom">
    <div class="flex flex-col md:flex-row gap-4 items-center justify-center">
      <!-- Vector Type Toggle -->
      <div class="inline-flex rounded-lg border border-gray-300 p-1 bg-gray-50">
        <%= link_to vectors_path(vector_type: 'sale', category: @category),
                    class: "inline-flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all #{@vector_type == 'sale' ? 'bg-bio-green text-white shadow-sm' : 'text-gray-700 hover:bg-gray-100'}" do %>
          <i class="bi bi-cart3"></i>
          For Sale
        <% end %>
        <%= link_to vectors_path(vector_type: 'subscription', category: @category),
                    class: "inline-flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all #{@vector_type == 'subscription' ? 'bg-bio-green text-white shadow-sm' : 'text-gray-700 hover:bg-gray-100'}" do %>
          <i class="bi bi-arrow-repeat"></i>
          Subscription (Twist)
        <% end %>
      </div>

      <!-- Category Toggle -->
      <div class="inline-flex rounded-lg border border-gray-300 p-1 bg-gray-50">
        <%= link_to vectors_path(vector_type: @vector_type, category: 'expression'),
                    class: "inline-flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all #{@category == 'expression' ? 'bg-bio-green text-white shadow-sm' : 'text-gray-700 hover:bg-gray-100'}" do %>
          <i class="bi bi-cpu"></i>
          Protein Expression
        <% end %>
        <%= link_to vectors_path(vector_type: @vector_type, category: 'engineering'),
                    class: "inline-flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all #{@category == 'engineering' ? 'bg-bio-green text-white shadow-sm' : 'text-gray-700 hover:bg-gray-100'}" do %>
          <i class="bi bi-tools"></i>
          Genome Engineering
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="container-custom py-8">
  <% if @vectors.empty? %>
    <div class="max-w-2xl mx-auto">
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 text-center">
        <i class="bi bi-info-circle text-blue-600 text-4xl mb-3"></i>
        <p class="text-gray-700">
          <% if @category == 'expression' %>
            <% if @vector_type == 'subscription' %>
              No protein expression vectors are currently available through Twist subscription. Please check back later or try genome engineering vectors.
            <% else %>
              No protein expression vectors are currently available for sale. Please check back later or try genome engineering vectors.
            <% end %>
          <% else %>
            <% if @vector_type == 'subscription' %>
              No genome engineering vectors are currently available through Twist subscription. Please check back later or try protein expression vectors.
            <% else %>
              No genome engineering vectors are currently available for sale. Please check back later or try protein expression vectors.
            <% end %>
          <% end %>
        </p>
      </div>
    </div>
  <% else %>
    <% @vectors_by_promoter.each do |promoter, vectors| %>
      <% if vectors.any? %>
        <section class="mb-12">
          <!-- Promoter Header -->
          <div class="flex items-center gap-4 mb-6 pb-4 border-b border-gray-200">
            <% if promoter.nil? %>
              <div class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center flex-shrink-0">
                <i class="bi bi-dash-circle text-2xl text-gray-400"></i>
              </div>
            <% elsif promoter.name.downcase == "none" %>
              <div class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center flex-shrink-0">
                <i class="bi bi-dash-circle text-2xl text-gray-400"></i>
              </div>
            <% elsif promoter.inducible? %>
              <div class="w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center flex-shrink-0">
                <i class="bi bi-lightning-fill text-2xl text-yellow-600"></i>
              </div>
            <% else %>
              <div class="w-12 h-12 rounded-full bg-bio-green/10 flex items-center justify-center flex-shrink-0">
                <i class="bi bi-play-fill text-2xl text-bio-green"></i>
              </div>
            <% end %>

            <div class="flex-grow">
              <h2 class="text-2xl font-semibold text-charcoal mb-1">
                <%= promoter.nil? ? "No Promoter" : "#{promoter.full_name} (#{promoter.name})" %>
              </h2>
              <p class="text-gray-600">
                <% if promoter.nil? %>
                  Vectors without a specific promoter
                <% elsif promoter.name.downcase == "none" %>
                  Vectors without a promoter sequence
                <% elsif promoter.inducible? %>
                  Inducible promoter<%= " - #{promoter.strength.downcase} expression" if promoter.strength.present? %> when induced
                <% else %>
                  Constitutive promoter<%= " - #{promoter.strength.downcase} expression" if promoter.strength.present? %>
                <% end %>
                <span class="text-gray-400">â€¢</span>
                <% if vectors.count == 1 %>
                  1 vector
                <% else %>
                  <%= vectors.count %> vectors
                <% end %>
              </p>
            </div>
          </div>

          <!-- Vector Cards Grid -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <% vectors.each do |vector| %>
              <div class="group bg-white rounded-xl border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300 hover:-translate-y-1 flex flex-col">
                <!-- Vector Map Image -->
                <% if vector.map_image_exists? && vector.map_thumbnail %>
                  <%= link_to vector_path(vector), class: "block overflow-hidden bg-gray-50" do %>
                    <% begin %>
                      <%= image_tag vector.map_thumbnail,
                                    class: "w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300",
                                    alt: "#{vector.name} vector map",
                                    loading: "lazy" %>
                    <% rescue => e %>
                      <div class="w-full h-48 flex items-center justify-center bg-gray-100">
                        <div class="text-center text-gray-400">
                          <i class="bi bi-image text-4xl mb-2"></i>
                          <p class="text-sm">Image unavailable</p>
                        </div>
                      </div>
                    <% end %>
                  <% end %>
                <% end %>

                <!-- Card Content -->
                <div class="p-6 flex flex-col flex-grow">
                  <!-- Title and Badge -->
                  <div class="flex items-start justify-between gap-3 mb-3">
                    <h3 class="text-lg font-semibold text-charcoal flex-grow">
                      <%= vector.name %>
                    </h3>
                    <% if vector.category.present? %>
                      <% if vector.category == 'Genome Engineering' %>
                        <span class="inline-flex items-center px-2 py-1 rounded-md bg-green-100 text-green-700 text-xs font-medium flex-shrink-0">Engineering</span>
                      <% elsif vector.category == 'Heterologous Protein Expression' %>
                        <span class="inline-flex items-center px-2 py-1 rounded-md bg-blue-100 text-blue-700 text-xs font-medium flex-shrink-0">Expression</span>
                      <% end %>
                    <% end %>
                  </div>

                  <!-- Description -->
                  <p class="text-gray-600 text-sm mb-4 flex-grow">
                    <%= truncate(vector.description, length: 120) %>
                  </p>

                  <!-- Specifications -->
                  <div class="space-y-1 mb-4 text-sm">
                    <div class="flex justify-between">
                      <span class="text-gray-500">Selection:</span>
                      <span class="font-medium text-gray-700"><%= vector.selection_marker&.name || "N/A" %></span>
                    </div>
                    <div class="flex justify-between">
                      <span class="text-gray-500">Type:</span>
                      <span class="font-medium text-gray-700"><%= vector.vector_type&.name || "N/A" %></span>
                    </div>
                    <div class="flex justify-between">
                      <span class="text-gray-500">Size:</span>
                      <span class="font-medium text-gray-700">
                        <% if vector.vector_size %>
                          <%= number_with_delimiter(vector.vector_size) %> bp
                        <% else %>
                          N/A
                        <% end %>
                      </span>
                    </div>
                    <% if vector.has_lox_sites? %>
                      <div class="pt-2">
                        <span class="inline-flex items-center px-2 py-1 rounded-md bg-yellow-100 text-yellow-800 text-xs font-medium">
                          <i class="bi bi-star-fill mr-1"></i>Lox sites
                        </span>
                      </div>
                    <% end %>
                  </div>

                  <!-- Price and Action -->
                  <div class="flex items-center justify-between pt-4 border-t border-gray-200 mt-auto">
                    <div>
                      <% if @vector_type == 'subscription' %>
                        <% if vector.subscription_price %>
                          <span class="text-2xl font-bold text-bio-green">$<%= number_with_precision(vector.subscription_price, precision: 0) %></span>
                          <span class="text-xs text-gray-500 block">per subscription</span>
                        <% else %>
                          <span class="text-sm text-gray-500">Contact for pricing</span>
                        <% end %>
                      <% else %>
                        <% if vector.sale_price %>
                          <span class="text-2xl font-bold text-bio-green">$<%= number_with_precision(vector.sale_price, precision: 0) %></span>
                        <% else %>
                          <span class="text-sm text-gray-500">Contact for pricing</span>
                        <% end %>
                      <% end %>
                    </div>
                    <%= link_to vector, class: "inline-flex items-center gap-2 px-4 py-2 bg-bio-green text-white text-sm font-medium rounded-lg hover:bg-bio-green-dark transition-colors" do %>
                      Details
                      <i class="bi bi-arrow-right"></i>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </section>
      <% end %>
    <% end %>
  <% end %>
</div>

<div class="container-custom py-8">
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8">
    <h1 class="text-4xl font-bold text-charcoal">Twist Vector Subscriptions</h1>
    <% if authenticated? %>
      <% unless @current_subscription %>
        <%= link_to new_subscription_path, class: "inline-flex items-center px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors" do %>
          Start Subscription
        <% end %>
      <% end %>
    <% else %>
      <%= link_to new_session_path, class: "inline-flex items-center px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors" do %>
        Sign In to Subscribe
      <% end %>
    <% end %>
  </div>

  <% if authenticated? && @current_subscription %>
    <div class="bg-green-50 border border-green-200 rounded-xl p-6 mb-8">
      <h5 class="text-lg font-semibold text-charcoal mb-3">Active Subscription</h5>
      <p class="text-gray-700 mb-2">Your Twist subscription is active with <strong><%= @current_subscription.vectors.count %></strong> vectors.</p>
      <p class="text-gray-700 mb-4">
        Renewal Date: <strong><%= @current_subscription.renewal_date.strftime("%B %d, %Y") %></strong>
        (<%= @current_subscription.days_until_renewal %> days remaining)
      </p>
      <div class="border-t border-green-200 pt-4">
        <%= link_to @current_subscription, class: "inline-flex items-center px-4 py-2 border-2 border-green-600 text-green-600 font-medium rounded-lg hover:bg-green-50 transition-colors" do %>
          Manage Subscription
        <% end %>
      </div>
    </div>
  <% else %>
    <div class="bg-blue-50 border border-blue-200 rounded-xl p-6 mb-8">
      <h5 class="text-lg font-semibold text-charcoal mb-3">Get Started with Twist Subscriptions</h5>
      <p class="text-gray-700 mb-3">Subscribe to our vectors onboarded at Twist Bioscience for seamless DNA synthesis and delivery.</p>
      <ul class="space-y-2 text-gray-700 list-disc list-inside mb-4">
        <li>$300 one-time onboarding fee</li>
        <li>Annual subscription with prorated pricing for vectors added throughout the year</li>
        <li>Minimum $50 fee for vectors added within 30 days of renewal</li>
        <li>Direct integration with your Twist account</li>
      </ul>
      <% unless authenticated? %>
        <div class="border-t border-blue-200 pt-4">
          <p class="text-gray-700"><strong>Account required:</strong> <%= link_to "Sign in", new_session_path, class: "text-blue-600 hover:text-blue-700 font-medium" %> or <%= link_to "create an account", new_session_path, class: "text-blue-600 hover:text-blue-700 font-medium" %> to start your subscription.</p>
        </div>
      <% end %>
    </div>
  <% end %>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <div class="lg:col-span-2">
      <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
          <h3 class="text-xl font-semibold text-charcoal">Available Subscription Vectors</h3>
        </div>
        <div class="p-6">
          <% if @vectors.any? %>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <% @vectors.each do |vector| %>
                <div class="bg-white border border-gray-200 rounded-lg p-6 hover:shadow-lg transition-all">
                  <h5 class="text-lg font-semibold text-charcoal mb-2">
                    <%= link_to vector.name, vector_path(vector), class: "text-bio-green hover:text-bio-green-dark transition-colors" %>
                  </h5>
                  <p class="text-gray-600 text-sm mb-4">
                    <%= truncate(vector.description, length: 100) %>
                  </p>
                  <div class="flex justify-between items-center">
                    <div>
                      <p class="text-2xl font-bold text-bio-green">$<%= vector.subscription_price %></p>
                      <p class="text-xs text-gray-500">per year</p>
                    </div>
                    <div>
                      <% if @current_subscription %>
                        <% if @current_subscription.vectors.include?(vector) %>
                          <span class="inline-flex items-center px-3 py-1 rounded-full bg-green-100 text-green-700 text-sm font-medium">Subscribed</span>
                        <% else %>
                          <%= button_to add_vector_subscription_path(@current_subscription),
                              params: { vector_id: vector.id },
                              method: :post,
                              class: "inline-flex items-center px-4 py-2 border-2 border-blue-600 text-blue-600 text-sm font-medium rounded-lg hover:bg-blue-50 transition-colors" do %>
                            Add to Subscription
                          <% end %>
                        <% end %>
                      <% else %>
                        <%= link_to new_subscription_path(vector_id: vector.id), class: "inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors" do %>
                          Subscribe
                        <% end %>
                      <% end %>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <div class="text-center py-12">
              <p class="text-gray-500">No subscription vectors are currently available.</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <div class="lg:col-span-1">
      <div class="bg-white rounded-xl border border-gray-200 overflow-hidden sticky top-20">
        <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
          <h4 class="text-lg font-semibold text-charcoal">Subscription Benefits</h4>
        </div>
        <div class="p-6">
          <ul class="space-y-3 mb-6">
            <li class="flex items-start gap-2 text-gray-700">
              <i class="bi bi-check-circle-fill text-bio-green flex-shrink-0 mt-0.5"></i>
              <span>Direct Twist integration</span>
            </li>
            <li class="flex items-start gap-2 text-gray-700">
              <i class="bi bi-check-circle-fill text-bio-green flex-shrink-0 mt-0.5"></i>
              <span>Automated DNA synthesis</span>
            </li>
            <li class="flex items-start gap-2 text-gray-700">
              <i class="bi bi-check-circle-fill text-bio-green flex-shrink-0 mt-0.5"></i>
              <span>Quality guaranteed sequences</span>
            </li>
            <li class="flex items-start gap-2 text-gray-700">
              <i class="bi bi-check-circle-fill text-bio-green flex-shrink-0 mt-0.5"></i>
              <span>Fast delivery times</span>
            </li>
            <li class="flex items-start gap-2 text-gray-700">
              <i class="bi bi-check-circle-fill text-bio-green flex-shrink-0 mt-0.5"></i>
              <span>Technical support included</span>
            </li>
            <li class="flex items-start gap-2 text-gray-700">
              <i class="bi bi-check-circle-fill text-bio-green flex-shrink-0 mt-0.5"></i>
              <span>Annual renewal with prorated additions</span>
            </li>
          </ul>

          <hr class="border-gray-200 my-6">

          <h6 class="font-semibold text-charcoal mb-3">Pricing Structure</h6>
          <ul class="space-y-2 text-sm text-gray-700">
            <li><strong>Onboarding:</strong> $300 (one-time)</li>
            <li><strong>Vectors:</strong> Individual annual pricing</li>
            <li><strong>Late additions:</strong> Prorated to renewal date</li>
            <li><strong>Minimum fee:</strong> $50 (last 30 days)</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
